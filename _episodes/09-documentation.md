---
title: "Documentation"
teaching: 40
exercises: 20
questions:
- "How can we document out module?"
objectives:
- "Run the lesson checking script and interpret its output correctly."
- "Explain in-code documentation"
- "Explain documentation tools like Read The Docs"
keypoints:
- "Some documentation is better than no documentation"
---

This episode discusses documentation strategies. In particular, we will focus on how to build documentation using Sphinx and host that documentation online using ReadTheDocs.

Documentation must be provided to allow for use, development, and maintenance
of software. Documentation is often overlooked by developers since it is
tedious and boring, however good documentation is an extremely good habit to
develop.

The documentation typically involves several components:

 - What your project does and why it is useful
 - Build requirements and dependencies (if applicable)
 - How to compile/build/test/install
 - How to use the software (through the API or through inputs)
 - Some examples
 - Who maintains the project


## README documentation

So far in our project, we have added things like installation and use instructions to our `README.md` which is displayed on our GitHub repository. We have also written in-code documentation in the form of comments and function doc strings. This works well for small projects, and may be all of the documentation you need for many of your projects. However, if you are preparing a software package to be widely used, you may want to make a website for people to find information about your package.

## Sphinx for complex modules

When you want to improve your documentation strategies for Python packages, use [Sphinx](https://www.sphinx-doc.org/en/master/). Sphinx is a tool for creating documentation and was originally created for documentation of the Python programming language.

With Sphinx and some extensions, you can write documentation giving instructions and examples of your software AND pull out the in code documentation we have already written as docstrings to document your API. The ability to pull out in-code doc-strings as documentation is an advantage - you won't have to maintain documentation in two places. Later, we will see how we can automatically generate our documentation every time we push to the repository.

Many projects you are familiar with use Sphinx for documentation - including numpy, matplotlib, and pytest. To see a list of project that use Sphinx, click [here](https://www.sphinx-doc.org/en/master/examples.html).

CookieCutter has already set up files which we need to get started with Sphinx.

### Using Sphinx to build documentation

To build your Sphinx documentation locally, you will first need to install Sphinx. This command installs Sphinx, and the Sphinx Read The Docs theme (the theme you use defines the style of your pages). There are many themes available for Sphinx, and if you view the Sphinx [examples](https://www.sphinx-doc.org/en/master/examples.html) you will see several themes you could choose from.

The command below installs the Sphinx software and a theme for your Sphinx Documentation. The cookiecutter comes preconfigured to use the [Sphinx ReadTheDocs theme](https://sphinx-rtd-theme.readthedocs.io/en/stable/) (or `sphinx_rtd_theme`), but there are many themes you can choose from if you wish. 

~~~
$ pip install sphinx
$ pip install sphinx_rtd_theme
~~~
{: .language-bash}

While we work with documentation, we will finally be looking at the third directory which CookieCutter created (remember that we've looked at the project directory, and the `devtools` directory). The files which CookieCutter has set up for Sphinx are in the `docs` folder. Navigate to that directory.

~~~
$ cd docs
~~~
{: .langauge-bash}

Next, look at the files in the directory

~~~
$ ls
~~~
{: .bash}

~~~
Makefile            _templates          getting_started.rst
README.md           api.rst             index.rst
_static             conf.py             make.bat
~~~
{: .output}

These are the files we will use to build our documentation.

The important files for you to edit in this directory end with the extension `.rst`. These are `reStructured text` files, and they are what Sphinx will use to build each page or section of your documentation. We have three restructured text files here to begin (`index.rst`, `getting_started.rst`, `api.rst`). The included `rst` pages were generated by the cookiecutter as a starting point for you.

When you build your documentation, the `index.rst` will be the index, or main page of your documentation. The other `rst` files are examples of pages you might want to have (from CookieCutter). Any time you want to make a new page, you can create a file with an `.rst` extension.

To build your documentation as html, type

~~~
$ make html
~~~
{: .language-bash}

This command tells Sphinx to generate your documentation as html pages. With this command, we are building HTML files from the reStructured text files.

Now notice when you type `ls` a some new directories have appeared.

~~~
ls
~~~
{: .language-bash}

~~~
Makefile            _static             autosummary         index.rst
README.md           _templates          conf.py             make.bat
_build              api.rst             getting_started.rst
~~~
{: .output}

In particular, notice the `_build` directory. Sphinx put the HTML files it generated here. There should now be files in your `_build/html` folder. You can open these files in your browser to preview what your documentation will look like.

## Adding Information to our Documentation

Noww, we will have the task of actually adding information about our project to our documentation. This part will require us to write! 

When writing Sphinx documentation, you use `reStructured Text (RST)` syntax. This is similar to markdown, but has notable difference. See this [reStructured Text Cheat Sheet](https://thomas-cokelaer.info/tutorials/sphinx/rest_syntax.html) for info on reStructured Text.

Let's start by adding a simple a description to your `index.rst` under the first heading.

~~~
Welcome to molecool's documentation!
=========================================================
molecool is a Python package designed to read in, perfom analysis,
and visualize molecular coordinates. The file formats `xyz` and `pdb` are
currently supported.
~~~

Next, clean your previous build and rebuild your pages.

~~~
$ make clean
$ make html
~~~
{: .language-bash}

Refresh the page in your browser to see the page with the new description.

CookieCutter has already added some other pages to our documentation, `getting_started.rst`, and `api.rst`. Let's tell someone how to get started on the 'Getting Started' page. Click the link on your HTML documentation  to see what is there already.

Right now, it says

~~~
This page details how to get started with molecool.
~~~

To changed this, we will edit the content of `getting_started.rst`

> ## Exercise - Getting Started
> Using the [reStructred Text Cheat Sheet](https://thomas-cokelaer.info/tutorials/sphinx/rest_syntax.html), add some information to your Getting Started page. Use the following guidelines:
> 
> - Add a text description under "Getting Started".
> - Create a subheading called "installation" which contains installation instructions.
> - The "Installation" secion should use a list for dependencies and a code block with the installation command.
>> ## Solution
>> Following the guidelines and using the cheat sheet may lead you to a page which looks like this:
>> ~~~
>> Getting Started
>> ===============
>>
>> This page details how to get started with molecool. Molecool is a package which was developed for the MolSSI Best Practices workshop.
>>
>> Installation
>> ------------
>> To install molecool, you will need an environment with the following packages:
>>
>> * Python 3.7
>> * NumPy
>> * Matplotlib
>>
>> Once you have these packages installed, you can install molecool in the same environment using::
>>
>>     pip install -e .
>> ~~~
>> 
>> Here, we have used astericks (`*`) to create a non-numbered list, and `::` followed by an indented block to indicate a code block.
> {: .solution}
{: .challenge}

We can also add a Python code block, for example. The Sphinx RTD Theme will use syntax highlighting for Python code.
~~~
Usage
-------
Once installed, you can use the package. This example draws a benzene molecule from an xyz file.::

    import molecool

    benzene_symbols, benzene_coords = molecool.open_xyz('benzene.xyz')
    benzene_bonds = molecool.build_bond_list(benzene_coords)
    molecool.draw_molecule(benzene_coords, benzene_symbols, draw_bonds=benzene_bonds)
~~~

## Sphinx Directives

The thing that really gives Sphinx special abilities are **directives**. Directives are extensions which can be used with your restructred text to add special sections, images, warnings, etc to your documentation, and are part of a package called [docutils](https://docutils.sourceforge.io/) which Sphinx is built on top of. You can see a general list of directives [here](https://www.sphinx-doc.org/en/master/usage/restructuredtext/basics.html#rst-directives), and a list of special Sphinx Directives [here]https://www.sphinx-doc.org/en/1.8/usage/restructuredtext/directives.html).

In general, the syntax for a directive is (with appropriate options and syntax)

~~~
.. directive_name::
  :option:
  :option:

  parameter
  parameter
~~~

### The Table of Contents Directive
The first directive we will discuss is the Table of Contents directive. Look at the file `index.rst`. It contains the `toctree` directive, which generates a special section called a Table of Contents which links to other parts of your projects. The Table of Contents on your `index.rst` file is what shows up on your main menu on the left of the page. It is also on your main page.

~~~
.. toctree::
   :maxdepth: 2
   :caption: Contents:

   getting_started
   api
~~~

The line `.. toctree::` is the line which starts with directives. Directives always start with two periods (`..`), followed by a space, then the directive name (`toctree` in this case), then two colons (`::`). Next, you hit enter and add any options for the directive. We then have options for depth of the the Table of Contents (what level of headers to show), as well as the "caption". You can see other options for this directive under "Additional options" on the [documentation page](https://www.sphinx-doc.org/en/1.8/usage/restructuredtext/directives.html). 

After the settings for the TOC tree, you list the name of the pages you want to be included in this Table of Contents. Right now, we are including the 'Getting Started' page and the API page.

Note that you add the __file name__ in the TOC Tree, but the title of the page (For example, for the `Getting Started` page, the page heading ('Getting Started') is what shows up in the TOC, but you list the file name without the extension is the TOC tree `getting_started`.)

> ## Exercise
> Create a new page with the title "About" that gives a description of the project. Specify that this project is for a MolSSI Best Practices Workshop, and put a link to the molssi homepage (molssi.org). Add your new page to the Table of Contents.
>
> What happens if you remove the page from the table of contents and rebuild the documentation.
>> ## Solution
>> First, create a new file called `about.rst`. Next, create a header and write a short desciption in `about.rst`.
>> ~~~
>> About this package
>> ----------------
>> This package and documentation are a sample created for the Best Practices Workshop held by `The Molecular Sciences Software Institute <https://molssi.org>`_.
>>
>> ~~~
>> Then, in `index.rst` add the name of the file at the top of your table of contents.
>> ~~~
>> .. toctree::
>>    :maxdepth: 2
>>    :caption: Contents:
>>
>>    getting_started
>>    api
>>    about
>> ~~~
>>
>> If you remove `about` from the TOC tree and rebuild, you will see the following error
>> ~~~
>>  ...PATH_TO_DIRECTORY/molecool/docs/about.rst: WARNING: document isn't included in any toctree
>> ~~~
>> {: .error}
>> Sphinx will warn you if you've created a page and not linked to it.
>>
>{: .solution}
{: .challenge}

> ## Building documentation as a PDF
> To build a pdf version of your documentation, you use the command
> ~~~
> make latexpdf
> ~~~
> {: .language-bash}
> This will create a folder called `pdf` in the `build` directory, and you should have a file in this directory called `molecool.pdf` containing all of your documentation. Each `rst` file is a chapter of the documentation, instead of a different page.
{: .callout}


## Automatically Generating Documentation Using Sphinx-AutoAPI
Sphinx comes bundled with some extensions which have other directives. You can also download and install many Sphinx extensions from pip or conda.

One common use of Sphinx is to create API documentation (ie, pull the docstrings from your modules) The cookiecutter comes bundled with Sphinx AutoSummary and AutoDoc extensions. This tutorial will demonstrate use of another Sphinx extension called AutoAPI. AutoAPI will pull documentation for all of your functions at once, rather than you having to build them manually.

This is [Spinx-AutoAPI](https://github.com/readthedocs/sphinx-autoapi). To install Sphinx-AutoAPI, use `pip`:

~~~
pip install sphinx-autoapi
~~~
{: .language-bash}

To get Sphinx-AutoAPI to work, we will need change some things about the Sphinx configuration, which is specified in the `conf.py`.

There are a few modifications necessary to use Sphinx-AutoAPI.  
 - In `docs/conf.py`, remove `sphinx.ext.autodoc` and `sphinx.ext.autosummary` and add `autoapi.extension` to the
 `extensions` list variable. Then comment out or delete the line: `autosummary_generate = True`.
 - Optional: remove `* :ref:'modindex'` from `docs/index.rst`, since an API Reference tab will show up autmoatically in
 `.. toctree::` after compilation.

Once this is configured, you may now choose the modules and functions you would like Sphinx-AutoAPI to include
or ignore in its automatic generation of documentation. To do this, in the `docs/conf.py` file, you may now add the
following lines directly following the declaration of the `extensions` variable:

~~~
autoapi_dirs = ['../molecool']
autoapi_ignore = ["*/tests/*",
                  "*_version.py"]
# for a detailed explanation of all the options below, visit the Sphinx-AutoAPI documentation. From there:
# private-members: Include private objects (eg. _foo in Python)
# special-members: Include special objects (eg. __foo__ in Python)
autoapi_options = [ 'members',
                    'undoc-members',
                    #'private-members',
                    #'special-members',
                    'show-inheritance',
                    'show-module-summary',
                    'imported-members']
~~~
{: .language-python}

All together, this section of the `conf.py` should look like:

~~~
...

extensions = [
    'autoapi.extension',
    'sphinx.ext.mathjax',
    'sphinx.ext.viewcode',
    'sphinx.ext.napoleon',
    'sphinx.ext.intersphinx',
    'sphinx.ext.extlinks',
]

autoapi_dirs = ['../molecool']
autoapi_ignore = ["*/tests/*",
                  "*_version.py"]
                  
autoapi_options = ['members', 
		'undoc-members', 
		#'private-members', 
		#'special-members', 
		'show-inheritance', 
		'show-module-summary', 
		'imported-members']
	
# autosummary_generate = True	# or delete this
napoleon_google_docstring = False
napoleon_use_param = False
napoleon_use_ivar = True
                  
...
~~~
{: .language-python}

Once compiled, this will generate documentation for all files in the `molecool` source directory, as well as exclude
generating documentation for the tests and versioneering files in the project. The `index.rst` file will be updated
to include an `API Reference` page, and the resultant `.html` files can be viewed in the `_build` directory upon 
compilation.


## Hosting your documentation

### Read The Docs
We recommend hosing your  documentation on [Read The Docs](https://readthedocs.org/). With this service, you can enable the building of your documentation every time you push to your repository.

Go to the [Read the Docs](https://readthedocs.org/) website. Log in with your GitHub username and hook the repository to read the docs. Push to the repository, or trigger a build on the site. Because of the recent switch from `master` to `main`, you may get an error that your build has failed. In order to fix this, click "Admin" in the menu, then on the side bar click "Advanced Settings". Under "Default branch" choose "main". Trigger a build again after making this change.

Unfortunately, your documentation build will fail again. This is because we need our dependencies installed on RTD. There is another file the CookieCutter has added which we must now modify. Add your dependencies (numpy and matplotlib) to `docs/requirements.yaml`. You should also add `sphinx-autoapi` under `pip only installs`. Your `requirements.yaml` will look like this:

~~~
name: docs
channels:
dependencies:
    # Base depends
  - python
  - pip

    # Package depends
  - numpy
  - matplotlib



    # Pip-only installs
  - pip:
    - sphinx-autoapi
~~~

Commit and push - your documentation should build successfully and you should be able to view it!


{% include links.md %}
